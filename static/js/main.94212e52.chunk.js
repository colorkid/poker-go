(this["webpackJsonppoker-go"]=this["webpackJsonppoker-go"]||[]).push([[0],{141:function(e,t,n){"use strict";n.r(t);var r,a=n(3),o=n(0),c=n(26),i=n.n(c),s=n(180),u=n(179),l=n(184),d=n(176),b=n(9),f=n(183),j=n(181),p=Object(d.a)({container:{width:"100%","& .MuiInput-input":{fontSize:28,width:380}},skeleton:{transform:"none"}}),m=function(e){var t=e.setNameStory,n=e.nameStory,r=e.subscribedState,c=Object(o.useState)(""),i=Object(b.a)(c,2),s=i[0],u=i[1],l=p();Object(o.useEffect)((function(){u(n)}),[n]);return Object(a.jsx)("div",{className:l.container,children:r?Object(a.jsx)(j.a,{value:s,label:"Name of story",variant:"standard",hiddenLabel:!0,onChange:function(e){u(e.target.value)},onBlur:function(e){t(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),t(e.target.value))}}):Object(a.jsx)(f.a,{width:294,height:65,className:l.skeleton})})},O=n(93),h=n.n(O),g=n(182);(r=new g.a).webSocketFactory=function(){return new h.a("https://poker-api.r2ls.ru/ws")},r.activate();var v={onSubscribe:function(e,t,n,a,o,c,i,s){r.onConnect=function(){n(),r.subscribe("/topic/room/topic-changed",(function(e){t(JSON.parse(e.body)),s()})),r.subscribe("/topic/room/im-here",(function(){var t={name:e().user.name};v.sendUserNameMeToo(t)})),r.subscribe("/topic/room/im-here-too",(function(e){a(JSON.parse(e.body))})),r.subscribe("/topic/room/i-left",(function(e){o(JSON.parse(e.body))})),r.subscribe("/topic/room/i-voted",(function(e){c(JSON.parse(e.body))})),r.subscribe("/topic/room/open-cards",(function(){var t=e().user,n={name:t.name,score:t.number};r.publish({destination:"/app/room/my-score",body:JSON.stringify(n)})})),r.subscribe("/topic/room/my-score",(function(e){i(JSON.parse(e.body))}))}},sendTaskName:function(e){r.publish({destination:"/app/room/topic-changed",body:JSON.stringify(e)})},sendUserName:function(e){r.publish({destination:"/app/room/im-here",body:JSON.stringify(e)})},sendUserNameMeToo:function(e){r.publish({destination:"/app/room/im-here-too",body:JSON.stringify(e)})},removeUser:function(e){r.publish({destination:"/app/room/i-left",body:JSON.stringify(e)})},vote:function(e){r.publish({destination:"/app/room/i-voted",body:JSON.stringify(e)})},openCards:function(e){r.publish({destination:"/app/room/open-cards",body:JSON.stringify(e)})}},y=n(10),x=function(e){return e.board.title},N=function(e){return e.board.subscribed},S=function(){var e=Object(y.c)(x),t=Object(y.c)(N);return Object(a.jsx)(m,{setNameStory:function(e){var t={title:e};v.sendTaskName(t)},nameStory:e,subscribedState:t})},C=Object(d.a)({player:{display:"flex",width:125,flexDirection:"column",alignItems:"center",wordBreak:"break-word",marginRight:-22.5,marginLeft:-22.5,"&:nth-child(odd)":{alignSelf:"flex-end"},"&:nth-child(even)":{alignSelf:"flex-start",paddingTop:5}},body:{backgroundColor:"rgba(0, 0, 0, 0.11)",width:35,height:65,borderRadius:4,transition:"0.2s",display:"flex",justifyContent:"center",alignItems:"center"},name:{fontSize:18,fontWeight:600,paddingTop:8,textAlign:"center",lineHeight:1.3,minHeight:54,display:"flex",alignItems:"center"},voted:{backgroundColor:"#115293"},number:{border:"2px solid #1976d2",borderRadius:4,color:"#1976d2",fontWeight:"bold",backgroundColor:"#fff"}}),k=function(e){var t=e.name,n=e.onDoubleClickHandler,r=e.isVoted,o=e.number,c=C();return Object(a.jsxs)("div",{className:c.player,children:[Object(a.jsx)("div",{className:"".concat(c.body," ").concat(r?c.voted:""," ").concat(o||0===o?c.number:""),children:-1===o?"?":o}),Object(a.jsx)("div",{className:c.name,onDoubleClick:n,children:t})]})},E=Object(d.a)({inputName:{minWidth:70,maxWidth:125,marginTop:12}}),w=function(e){var t,n=e.name,r=e.setName,c=e.votedUsers,i=e.scores,s=Object(o.useState)(""),u=Object(b.a)(s,2),l=u[0],d=u[1],f=E();return Object(a.jsx)(a.Fragment,{children:n?Object(a.jsx)(k,{name:n,onDoubleClickHandler:function(){n.length&&v.removeUser({name:n}),d(n),r("")},isVoted:null===c||void 0===c?void 0:c.includes(n),number:null===i||void 0===i||null===(t=i.find((function(e){return e.name===n})))||void 0===t?void 0:t.score}):Object(a.jsx)(j.a,{className:f.inputName,label:"Your name",variant:"standard",value:l,onChange:function(e){d(e.target.value)},onBlur:function(){r(l)},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),r(l))},autoFocus:!0})})},T="SET_NAME",R="PUSH_USER_NAME",U="REMOVE_USER",D="VOTED_USER",J="SHOW_CARD",M="SET_NUMBER",_="RE_VOTE",W="NEW_GAME",A=function(e){return{type:R,payload:e}},I=function(e){return{type:U,payload:e}},B=function(e){return{type:D,payload:e}},F=function(e){return{type:J,payload:e}},H=function(){return{type:W}},V=function(e){return e.user.name},G=function(e){return e.user.colleagues.filter((function(e){return e.length>0}))},L=function(e){return e.user.votedColleagues},z=function(e){return e.user.scores},P=function(){var e=Object(y.c)(V),t=Object(y.c)(L),n=Object(y.c)(z),r=Object(y.c)(N),c=Object(o.useState)(""),i=Object(b.a)(c,2),s=i[0],u=i[1],l=Object(y.b)();Object(o.useEffect)((function(){u(e)}),[e]),Object(o.useEffect)((function(){s.length&&(d(),j())}),[s]);var d=function(){l({type:T,payload:{name:s}}),v.sendUserName({name:s})},j=function(){window.addEventListener("beforeunload",(function(e){return e.preventDefault(),v.removeUser({name:s})}))};return Object(a.jsx)(a.Fragment,{children:r?Object(a.jsx)(w,{name:s,setName:u,votedUsers:t,scores:n}):Object(a.jsx)(f.a,{width:125,height:48})})},K=function(){var e=Object(y.c)(G),t=Object(y.c)(V),n=Object(y.c)(L),r=Object(y.c)(z);return Object(a.jsx)(a.Fragment,{children:e.map((function(e){var o;return t!==e&&Object(a.jsx)(k,{name:e,isVoted:n.includes(e),number:null===r||void 0===r||null===(o=r.find((function(t){return t.name===e})))||void 0===o?void 0:o.score},e)}))})},Y=Object(d.a)({container:{display:"flex",alignItems:"center",position:"relative",height:425},table:{position:"absolute",width:"calc(100% + 80px)",height:150,display:"block",backgroundColor:"rgba(0, 0, 0, 0.11)",borderRadius:25,marginLeft:-40}}),q=function(){var e=Y();return Object(a.jsxs)("div",{className:e.container,children:[Object(a.jsx)("div",{className:e.table}),Object(a.jsx)(P,{}),Object(a.jsx)(K,{})]})},Q=[0,1,2,3,5,8,13,21,34,55,89,-1],X=Object(d.a)({cardsWrapper:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",width:"100%",maxWidth:725},card:{width:50,height:80,display:"flex",justifyContent:"center",alignItems:"center",border:"2px solid #1976d2",borderRadius:4,color:"#1976d2",fontSize:20,fontWeight:"bold",cursor:"pointer",transition:"0.2s","&:hover":{transform:"translate(0, -4px)",backgroundColor:"rgba(0, 0, 0, 0.04)"}},title:{width:"100%",textAlign:"center",fontWeight:300},cardActive:{transform:"translate(0, -4px)",backgroundColor:"rgba(0, 0, 0, 0.04)"}}),Z=function(e){var t=e.setEstimation,n=e.estimation,r=X(),c=Object(o.useMemo)((function(){return Q.map((function(e){return Object(a.jsx)("div",{className:"".concat(r.card," ").concat(n===e&&r.cardActive),onClick:function(){return function(e){t(e)}(e)},children:-1===e?"?":e},e)}))}),[n]);return Object(a.jsxs)("div",{className:r.cardsWrapper,children:[Object(a.jsx)("p",{className:r.title,children:"Choose your card"}),c]})},$=function(){var e=Object(y.c)(V),t=Object(o.useState)(""),n=Object(b.a)(t,2),r=n[0],c=n[1],i=Object(y.b)(),s=function(e){i(function(e){return{type:_,payload:e}}(e))},u=function(e){i({type:M,payload:e})};return Object(o.useEffect)((function(){if(e.length){var t={name:e};s(t),u(r),v.vote(t)}}),[r]),Object(a.jsx)(Z,{setEstimation:c,estimation:r})},ee=Object(d.a)({button:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px 16px",borderRadius:4,backgroundColor:"#4791db",color:"#fff",cursor:"pointer",marginTop:16,transition:"0.2s","&:hover":{backgroundColor:"#1976d2"},"&:active":{backgroundColor:"#115293"}},buttonDisabled:{pointerEvents:"none",opacity:.5},skeleton:{transform:"none",marginTop:16}}),te=function(e){var t=e.sayShowCards,n=e.disabledButton,r=e.subscribedState,o=ee();return Object(a.jsx)(a.Fragment,{children:r?Object(a.jsx)("div",{className:"".concat(o.button," ").concat(n?o.buttonDisabled:""),onClick:function(){t()},children:"Show cards"}):Object(a.jsx)(f.a,{width:116,height:40,className:o.skeleton})})},ne=function(){var e=Object(y.c)(V),t=Object(y.c)(L),n=Object(y.c)(G),r=Object(y.c)(N),o=!n.length||t.length<n.length;return Object(a.jsx)(te,{sayShowCards:function(){var t={name:e};v.openCards(t)},disabledButton:o,subscribedState:r})},re=Object(d.a)({button:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px 16px",borderRadius:4,backgroundColor:"#e57373",color:"#fff",cursor:"pointer",marginTop:16,transition:"0.2s","&:hover":{backgroundColor:"#f44336"},"&:active":{backgroundColor:"#d32f2f"}},buttonDisabled:{pointerEvents:"none",opacity:.5},skeleton:{transform:"none",marginTop:16}}),ae=function(e){var t=e.clearEstimations,n=re();return Object(a.jsx)("div",{className:n.button,onClick:function(){t()},children:"Re-vote"})},oe=function(){var e=Object(y.b)();return Object(a.jsx)(ae,{clearEstimations:function(){e(H())}})},ce=Object(d.a)({board:{height:"100%",padding:16},header:{display:"flex",flexWrap:"wrap"},middle:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100vh - 325px)",padding:16},footer:{display:"flex",justifyContent:"center"},buttons:{display:"flex",alignItems:"flex-start",flexDirection:"column"}}),ie=function(){var e=ce();return Object(a.jsxs)("div",{className:e.board,children:[Object(a.jsxs)("header",{className:e.header,children:[Object(a.jsx)(S,{}),Object(a.jsxs)("div",{className:e.buttons,children:[Object(a.jsx)(ne,{}),Object(a.jsx)(oe,{})]})]}),Object(a.jsx)("div",{className:e.middle,children:Object(a.jsx)(q,{})}),Object(a.jsx)("footer",{className:e.footer,children:Object(a.jsx)($,{})})]})},se=function(){return Object(a.jsx)(ie,{})},ue=n(25),le=n.n(ue),de=n(58),be="GET_NAME_STORY",fe="SET_SUBSCRIBE_STATE",je=function(e){return{type:be,payload:e}},pe=Object(d.a)({root:{display:"flex",flexDirection:"column",minHeight:"100vh"}}),me=function(){var e=pe(),t=Object(y.b)();return Object(o.useEffect)((function(){t(function(){var e=Object(de.a)(le.a.mark((function e(t,n){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v.onSubscribe(n,(function(e){return t(je(e))}),(function(){return t({type:fe,payload:!0})}),(function(e){return t(A(e))}),(function(e){return t(I(e))}),(function(e){return t(B(e))}),(function(e){return t(F(e))}),(function(){return t(H())}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}),[]),Object(a.jsx)("div",{className:e.root,children:Object(a.jsx)(se,{})})},Oe=n(96),he=n(60),ge=Object(Oe.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:he.a.A400},background:{default:"#f5f5f5"}}}),ve=n(40),ye=n(95),xe=n(17),Ne="GET_MESSAGE",Se={allMessages:[]},Ce=n(14),ke={title:"",subscribed:!1},Ee={name:"",colleagues:[],votedColleagues:[],number:null,scores:[]},we=function(e,t){var n=e.filter((function(e){return e.name!==t.name}));return[].concat(Object(xe.a)(n),[t])},Te=function(e,t){return e.colleagues.includes(t)?e:Object(Ce.a)(Object(Ce.a)({},e),{},{colleagues:[].concat(Object(xe.a)(e.colleagues),[t])})},Re=function(e,t){return e.votedColleagues.includes(t)?e:Object(Ce.a)(Object(Ce.a)({},e),{},{scores:e.scores.filter((function(e){return e.name!==t})),votedColleagues:[].concat(Object(xe.a)(e.votedColleagues),[t])})},Ue=Object(ve.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ne:return{allMessages:[].concat(Object(xe.a)(e.allMessages),[t.payload])};default:return e}},board:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case be:return Object(Ce.a)(Object(Ce.a)({},e),{},{title:t.payload.title});case fe:return Object(Ce.a)(Object(Ce.a)({},e),{},{subscribed:!!t.payload});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return Object(Ce.a)(Object(Ce.a)({},e),{},{name:t.payload.name});case R:return Te(e,t.payload.name);case W:return Object(Ce.a)(Object(Ce.a)({},e),{},{number:null,scores:[],votedColleagues:[]});case U:return Object(Ce.a)(Object(Ce.a)({},e),{},{colleagues:e.colleagues.filter((function(e){return e.length&&e!==t.payload.name}))});case D:return Re(e,t.payload.name);case M:return Object(Ce.a)(Object(Ce.a)({},e),{},{number:t.payload});case J:return Object(Ce.a)(Object(Ce.a)({},e),{},{votedColleagues:[],number:null,scores:we(e.scores,t.payload)});case _:return Object(Ce.a)(Object(Ce.a)({},e),{},{scores:e.scores.filter((function(e){return e.name!==t.payload.name}))});default:return e}}}),De=Object(ve.d)(Ue,Object(ve.a)(ye.a));i.a.render(Object(a.jsx)(u.a,{injectFirst:!0,children:Object(a.jsxs)(l.a,{theme:ge,children:[Object(a.jsx)(s.a,{}),Object(a.jsx)(y.a,{store:De,children:Object(a.jsx)(me,{})})]})}),document.querySelector("#root"))}},[[141,1,2]]]);
//# sourceMappingURL=main.94212e52.chunk.js.map